package com.example.test5;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;

public class VulnerabilityChecker {

    public String checkVulnerability(String url, String payload) {
        try {
            URL target = new URL(url + payload);
            HttpURLConnection connection = (HttpURLConnection) target.openConnection();
            connection.setInstanceFollowRedirects(false); // 设置连接不自动重定向
            connection.setRequestMethod("GET");
            connection.setDoOutput(true);
            connection.setReadTimeout(5000); // 设置超时时间为5秒
            int responseCode = connection.getResponseCode();
            BufferedReader in = new BufferedReader(new InputStreamReader(connection.getInputStream())); // 读取返回结果
            String inputLine;
            StringBuffer response = new StringBuffer();
            while ((inputLine = in.readLine()) != null) {
                response.append(inputLine);
            }
            in.close();
            return responseCode == 200 ? response.toString() : " [-]漏洞不存在!!! \n";
        } catch (IOException e) {
            return "请求出错：" + e.getMessage() + "\n";
        }
    }

    public String executeCommand(String url, String payload) {
        try {
            URL target = new URL(url + payload);
            HttpURLConnection connection = (HttpURLConnection) target.openConnection();
            connection.setInstanceFollowRedirects(false); // 设置连接不自动重定向
            connection.setRequestMethod("GET");
            connection.setDoOutput(true);
            connection.setReadTimeout(5000); // 设置超时时间为5秒
            BufferedReader in = new BufferedReader(new InputStreamReader(connection.getInputStream())); // 读取返回结果
            String Line;
            StringBuffer response = new StringBuffer();
            while ((Line = in.readLine()) != null) {
                response.append(Line).append("\n"); // 在每行末尾添加换行符
            }
            in.close();
            return response.toString();
        } catch (IOException e) {
            return "请求出错：" + e.getMessage() + "\n";
        }
    }
}